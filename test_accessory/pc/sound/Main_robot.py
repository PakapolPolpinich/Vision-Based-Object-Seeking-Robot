import time
from voice_driver import VoiceCommander # ‡∏î‡∏∂‡∏á Library ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏°‡∏≤‡πÉ‡∏ä‡πâ

# --- [1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (Mapping)] ---
# ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏´‡∏∏‡πà‡∏ô‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£ ‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
MY_COMMANDS = {
    "CMD_TANK":  ["‡∏£‡∏ñ‡∏ñ‡∏±‡∏á"],
    "CMD_PLANE": ["‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô"],
    "CMD_BIKE":  ["‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå", "‡∏°‡∏≠‡πÑ‡∏ã‡∏Ñ‡πå"],
    "CMD_DOLL":  ["‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤",]
}

# --- [2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö] ---
# mic_index=None ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡∏Ñ‡πå‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏•‡∏¢ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏≤‡πÄ‡∏•‡∏Ç)
# ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏µ‡πÑ‡∏°‡∏Ñ‡πå‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏î‡∏±‡∏á ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô 0, 1, 2 ‡∏î‡∏π
commander = VoiceCommander(mic_index=None, keywords=MY_COMMANDS)

# (Optional) ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏Ñ‡∏≠‡∏°‡∏°‡∏µ‡πÑ‡∏°‡∏Ñ‡πå‡∏Å‡∏µ‡πà‡∏ï‡∏±‡∏ß ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏≤‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏•‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
# commander.list_microphones()

# --- [3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå (Action)] ---
def run_robot_simulation(action_value):
    print("\n" + "="*40)
    print(f"ü§ñ ROBOT STATUS: EXECUTING [{action_value}]")
    print("üö´ SYSTEM: Mic is BLOCKED (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏£‡∏ö‡∏Å‡∏ß‡∏ô)")
    print("="*40)
    
    duration = 3 # ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    
    # ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á)
    if action_value == "CMD_TANK":
        print("   üöú (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏µ‡∏ô‡∏ï‡∏∞‡∏Ç‡∏≤‡∏ö) ‡∏Ñ‡∏£‡∏∑‡∏î‡∏î‡∏î... ‡∏Ñ‡∏£‡∏∑‡∏î‡∏î‡∏î...")
        duration = 5 # ‡∏£‡∏ñ‡∏ñ‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ä‡πâ‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢
    elif action_value == "CMD_PLANE":
        print("   ‚úàÔ∏è (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏ö‡∏û‡∏±‡∏î) ‡∏ü‡∏¥‡πâ‡∏ß‡∏ß‡∏ß‡∏ß‡∏ß‡∏ß....")
    elif action_value == "CMD_BIKE":
        print("   üèçÔ∏è (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå) ‡∏ö‡∏£‡∏∑‡πâ‡∏ô‡∏ô‡∏ô‡∏ô‡∏ô!")
    elif action_value == "CMD_DOLL":
        print("   üõë (‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏¥‡πà‡∏á) ...")
        duration = 2

    # Loop ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (Blocking Mode)
    # ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≠‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Ñ‡∏£‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
    for i in range(duration):
        print(f"   ... ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πà‡∏á {i+1}/{duration} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ")
        time.sleep(1) # ‡∏´‡∏¢‡∏∏‡∏î‡∏£‡∏≠ 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        
    print("\n‚úÖ ‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! (‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡∏Ñ‡πå‡∏£‡∏≠‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ)")
    print("-" * 40)

# --- [4. Main Loop] ---
def main():
    print("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö Voice Command ‡∏ö‡∏ô PC...")
    print(f"üìù ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: {list(MY_COMMANDS.keys())}")
    
    while True:
        try:
            # 1. ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á ‡∏à‡∏∞‡πÑ‡∏î‡πâ None)
            command = commander.listen()
            
            # 2. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏°‡∏≤
            if command:
                # 3. ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Blocking)
                run_robot_simulation(command)
                
                # 4. ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏£‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà

        except KeyboardInterrupt:
            print("\nüëã ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°")
            break

if __name__ == "__main__":
    main()